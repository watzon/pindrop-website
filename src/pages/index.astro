---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Button from '../components/Button.astro';
import FeatureCard from '../components/FeatureCard.astro';
import GlassCard from '../components/GlassCard.astro';
import Icon from '../components/Icon.astro';
import { Image } from 'astro:assets';
import screenshot from '../assets/images/screenshot.png';

// Fetch latest release from GitHub at build time
let latestVersion = 'v1.0';
let downloadUrl = 'https://github.com/watzon/pindrop/releases/latest/download/Pindrop.dmg';
try {
  const response = await fetch('https://api.github.com/repos/watzon/pindrop/releases/latest');
  if (response.ok) {
    const data = await response.json();
    latestVersion = data.tag_name || 'v1.0';
    // Find the Pindrop.dmg asset in the release
    const dmgAsset = data.assets?.find((asset: any) => asset.name === 'Pindrop.dmg');
    if (dmgAsset?.browser_download_url) {
      downloadUrl = dmgAsset.browser_download_url;
    }
  }
} catch (e) {
  // Fallback to static values if API fails
  console.warn('Failed to fetch latest release from GitHub:', e);
}

const valuePillars = [
  {
    icon: 'apple',
    title: 'Mac-Native',
    description: 'Built with pure Swift and SwiftUI. Not a web wrapper. Feels right at home on macOS.'
  },
  {
    icon: 'shield',
    title: 'Privacy-First',
    description: '100% local transcription. Your voice never leaves your Mac. No cloud, no tracking.'
  },
  {
    icon: 'zap',
    title: 'Apple Silicon Optimized',
    description: 'Blazing fast performance using the Neural Engine. 2-3x faster than generic Whisper.'
  },
  {
    icon: 'sparkles',
    title: '100% Open Source',
    description: 'Transparent code, MIT license. No subscriptions, no hidden costs, no lock-in.'
  }
];

const features = [
  {
    title: 'Global Hotkeys',
    description: 'Trigger dictation from anywhere with a customizable shortcut. Toggle mode or push-to-talk for ultimate control.',
    icon: 'keyboard'
  },
  {
    title: 'Transcription History',
    description: 'Never lose a thought. Search through your past dictations and export them to text files or copy to clipboard.',
    icon: 'mic'
  },
  {
    title: 'Multiple Models',
    description: 'Choose the right balance of speed and accuracy. Support for Tiny, Base, Small, Medium, and Large Whisper models.',
    icon: 'zap'
  },
  {
    title: 'Custom Dictionary',
    description: 'Teach Pindrop your jargon. Add custom words and phrases to improve accuracy for specialized terminology.',
    icon: 'sparkles'
  }
];
---

<Layout title="Pindrop - Mac-Native AI Dictation">
  <div class="relative overflow-hidden">
    <!-- Background Gradients -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-brand-orange/20 rounded-full blur-[120px] -z-10 mix-blend-screen opacity-50"></div>
    <div class="absolute top-[20%] right-0 w-[800px] h-[600px] bg-brand-pink/20 rounded-full blur-[100px] -z-10 mix-blend-screen opacity-40"></div>
    <div class="absolute bottom-0 left-0 w-[600px] h-[600px] bg-brand-magenta/20 rounded-full blur-[120px] -z-10 mix-blend-screen opacity-40"></div>

    <Header />

    <main class="pt-32 pb-20 px-6 md:px-12 max-w-7xl mx-auto space-y-32">
      
      <!-- Hero Section -->
      <section class="flex flex-col items-center text-center space-y-8 animate-fade-in">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass text-sm font-medium text-brand-orange animate-pulse-slow">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-orange opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-brand-orange"></span>
          </span>
          {latestVersion} Now Available
        </div>
        
        <h1 class="text-5xl md:text-7xl font-display font-bold tracking-tight text-white max-w-4xl leading-tight">
          Mac-native AI dictation. <br />
          <span class="gradient-text">Completely private.</span>
        </h1>
        
        <p class="text-xl text-text-secondary max-w-2xl leading-relaxed">
          Experience lightning-fast, highly accurate voice typing powered by on-device AI. 
          Optimized for Apple Silicon. Zero data leaves your machine.
        </p>
        
        <div class="flex flex-col sm:flex-row items-center gap-4 pt-4">
          <Button href={downloadUrl} data-download-trigger={downloadUrl} size="lg" icon="download" variant="gradient">
            Download for macOS
          </Button>
          <Button href="https://github.com/watzon/pindrop" size="lg" icon="github" variant="secondary" external>
            View on GitHub
          </Button>
        </div>
        
        <div class="pt-16 relative w-full max-w-5xl group">
          <div class="shadow-glow-lg rounded-2xl overflow-hidden border border-white/10 bg-surface-800 group-hover:scale-[1.02] group-hover:shadow-glow-md transition-all duration-500 ease-out-expo">
             <div class="relative">
               <Image
                src={screenshot}
                alt="Pindrop App Screenshot"
                width={1200}
                height={800}
                class="w-full h-auto object-cover block"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-surface-900 via-transparent to-transparent pointer-events-none rounded-2xl"></div>
             </div>
          </div>
        </div>
      </section>

      <!-- Value Pillars -->
      <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {valuePillars.map(pillar => (
          <GlassCard class="flex flex-col items-start gap-4 p-6 hover:bg-white/5 transition-colors">
            <div class="p-3 rounded-lg bg-gradient-to-br from-brand-orange/20 to-brand-pink/20 text-brand-orange ring-1 ring-white/10">
              <Icon name={pillar.icon as any} size={28} />
            </div>
            <div>
              <h3 class="text-lg font-bold text-white mb-2">{pillar.title}</h3>
              <p class="text-sm text-text-secondary leading-relaxed">{pillar.description}</p>
            </div>
          </GlassCard>
        ))}
      </section>

      <!-- Features Section -->
      <section id="features" class="relative">
        <div class="text-center max-w-3xl mx-auto mb-16 space-y-4">
          <h2 class="text-3xl md:text-5xl font-display font-bold text-white">
            Everything you need for <span class="gradient-text">voice productivity</span>
          </h2>
          <p class="text-lg text-text-secondary">
            Powerful features designed for power users, wrapped in a beautiful native interface.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          {features.map((feature, index) => (
            <GlassCard class={`flex flex-col justify-between p-8 group overflow-hidden relative border-white/5 hover:border-brand-pink/30 transition-all duration-500`}>
              <div class="absolute top-0 right-0 p-32 bg-brand-orange/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-brand-pink/10 transition-colors duration-500"></div>
              
              <div class="relative z-10">
                <div class="mb-6 inline-flex p-3 rounded-xl bg-surface-800 border border-white/10 text-brand-pink shadow-lg">
                  <Icon name={feature.icon as any} size={32} />
                </div>
                <h3 class="text-2xl font-bold text-white mb-3">{feature.title}</h3>
                <p class="text-text-secondary leading-relaxed text-lg">{feature.description}</p>
              </div>
            </GlassCard>
          ))}
        </div>
      </section>

      <!-- Comparison Table -->
      <section id="comparison" class="max-w-5xl mx-auto">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-display font-bold text-white mb-4">Why Pindrop?</h2>
          <p class="text-text-secondary">See how we stack up against the alternatives.</p>
        </div>

        <div class="glass rounded-2xl overflow-hidden border border-white/10">
          <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse min-w-[600px]">
              <thead>
                <tr class="bg-white/5 border-b border-white/10">
                  <th class="p-6 text-sm font-medium text-text-muted uppercase tracking-wider w-1/4">Feature</th>
                  <th class="p-6 text-lg font-bold text-white bg-white/5 border-x border-white/10 w-1/4 text-center">
                    <span class="gradient-text">Pindrop</span>
                  </th>
                  <th class="p-6 text-sm font-medium text-text-secondary w-1/4 text-center">Handy</th>
                  <th class="p-6 text-sm font-medium text-text-secondary w-1/4 text-center">OpenWhispr</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-white/5 text-sm md:text-base">
                {[
                  ['Platform', 'macOS only (Native)', 'Cross-platform', 'Cross-platform'],
                  ['Framework', 'Swift/SwiftUI', 'Tauri (Web Wrapper)', 'Tauri (Web Wrapper)'],
                  ['ML Engine', 'WhisperKit (CoreML)', 'Generic Whisper', 'Generic Whisper'],
                  ['Apple Silicon', 'Native Optimization', 'Emulated', 'Emulated'],
                  ['Privacy', '100% Local', 'Local', 'Local'],
                  ['Cost', 'Free & Open Source', 'Free & Open Source', 'Freemium / Paid'],
                ].map((row, i) => (
                  <tr class="hover:bg-white/5 transition-colors">
                    <td class="p-6 font-medium text-text-primary">{row[0]}</td>
                    <td class="p-6 text-center font-bold text-white bg-white/5 border-x border-white/10 shadow-[inset_0_0_20px_rgba(255,255,255,0.02)]">
                      {row[1]}
                    </td>
                    <td class="p-6 text-center text-text-secondary">{row[2]}</td>
                    <td class="p-6 text-center text-text-secondary">{row[3]}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Pre-Footer CTA -->
      <section class="relative py-20 px-6 md:px-20 text-center overflow-hidden rounded-3xl glass border border-white/10 group">
        <div class="absolute inset-0 bg-gradient-to-r from-brand-orange/20 via-brand-pink/20 to-brand-magenta/20 opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
        <div class="relative z-10 space-y-8">
          <h2 class="text-4xl md:text-5xl font-display font-bold text-white">
            Ready to try <span class="gradient-text">truly private</span> dictation?
          </h2>
          <p class="text-xl text-text-secondary max-w-2xl mx-auto">
            Join thousands of users who have switched to local, fast, and secure voice typing on their Mac.
          </p>
          
          <div class="flex flex-col items-center gap-4">
            <Button href={downloadUrl} data-download-trigger={downloadUrl} size="lg" icon="download" variant="gradient" class="px-12 py-4 text-xl">
              Download Pindrop
            </Button>
            <p class="text-sm text-text-muted mt-4">
              Requires macOS 14+ (Sonoma) or later. Apple Silicon (M1/M2/M3) highly recommended.
            </p>
          </div>
        </div>
      </section>

    </main>

    <Footer />
  </div>
</Layout>

<style>
  .perspective-1000 {
    perspective: 1000px;
  }
  .rotate-x-12 {
    transform: rotateX(12deg);
  }
</style>
