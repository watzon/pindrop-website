---
import Button from './Button.astro';
import pindropLogo from '../assets/pindrop-logo.svg';

const navItems = [
  { label: 'Features', href: '/#features' },
  { label: 'Comparison', href: '/#comparison' },
  { label: 'Blog', href: '/blog' },
  { label: 'Community', href: '/community' },
  { label: 'GitHub', href: 'https://github.com/watzon/pindrop', external: true },
];

// Fetch latest release download URL at build time
let downloadUrl = 'https://github.com/watzon/pindrop/releases/latest/download/Pindrop.dmg';
try {
  const response = await fetch('https://api.github.com/repos/watzon/pindrop/releases/latest');
  if (response.ok) {
    const data = await response.json();
    const dmgAsset = data.assets?.find((asset: any) => asset.name === 'Pindrop.dmg');
    if (dmgAsset?.browser_download_url) {
      downloadUrl = dmgAsset.browser_download_url;
    }
  }
} catch (e) {
  // Fallback to static URL if API fails
}
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-4 px-6 md:px-12">
  <nav class="max-w-7xl mx-auto flex items-center justify-between glass rounded-full px-6 py-3">
    <a href="/" class="flex items-center gap-2 group">
      <img src={pindropLogo.src} alt="" width="18" height="18" class="group-hover:scale-110 transition-transform duration-300" />
      <span class="font-display font-bold text-xl tracking-tight">Pindrop</span>
    </a>

    <div class="hidden md:flex items-center gap-8">
      {navItems.map(item => (
        <a 
          href={item.href} 
          class="text-sm font-medium text-text-secondary hover:text-white transition-colors"
          target={item.external ? "_blank" : undefined}
        >
          {item.label}
        </a>
      ))}
    </div>

    <div class="flex items-center gap-4">
      <Button href={downloadUrl} data-download-trigger={downloadUrl} size="sm" icon="download" variant="primary">
        Download
      </Button>
    </div>
  </nav>
</header>
